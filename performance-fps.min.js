!function(s,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):s.performanceFps=e()}(this,function(){"use strict";return class{static fpsToMs(s){return 1/s*1e3}static msToFps(s){return 1e3/s}get currentFps(){return Math.min(1e3/this.ms,this.props.maxFps)}get currentPerformance(){return this.performance}constructor(s){this.events={},this.props=Object.assign({min:-2,max:3,start:0,samples:30,accuracy:96,delay:1e3,maxFps:60,minFps:30,checkFps:55,upperCheckFps:58,maxTryToUpper:3,reCheckAfter:6e4},s),this.now=(()=>performance.now()||Date.now),this.reset(),this.onPause=this.onPause.bind(this),document.addEventListener("visibilitychange",this.onPause,!1)}getEvent(s){return void 0===this.events[s]&&(this.events[s]=new Set),this.events[s]}on(s,e){this.getEvent(s).add(e)}emit(s,...e){this.getEvent(s).forEach(s=>{s.apply(this,e)})}removeListener(s,e){this.getEvent(s).delete(e)}onChange(s){return this.on("change",s)}onPause(){this.isPaused=document.hidden,this.reset()}destroy(){document.removeEventListener("visibilitychange",this.onPause,!1),this.removeListener("change",this.performance)}reset(s){this.upper=0,this.ms=this.constructor.fpsToMs(this.props.maxFps),this.average=this.ms,s||(this.prev=this.now(),this.performance=this.props.start,this.reCheckAfter=this.props.reCheckAfter,this.checkCurrentFps=this.props.checkFps,this.isTooLow=!1,this.failIncrement=0,this.elapsedTime=0,this.resetTime=0,this.store=[],this.storedMs=0),this.delay||(this.delay=this.props.delay)}update(){if(this.isTooLow||this.isPaused)return;const s=this.now(),e=s-this.prev;if(this.prev=s,this.ms=e,!(s<this.delay)&&(this.storedMs+=e,this.storedMs>=this.props.accuracy&&this.performance>this.props.min)){if(0===e)return;this.delay=0,s>this.reCheckAfter&&(this.reset(!0),this.reCheckAfter+=s,this.resetTime+=1),this.store.push(e),this.store.length>this.props.samples-1&&(this.average=this.store.reduce((s,e)=>s+e)/this.store.length,this.constructor.msToFps(this.average)<=this.props.minFps?(this.performance=this.props.min,this.isTooLow=!0):this.constructor.msToFps(this.average)<this.checkCurrentFps?(this.performance-=1,this.upper>0&&(this.failIncrement+=1),this.checkCurrentFps=this.props.checkFps):this.constructor.msToFps(this.average)>this.props.maxFps-2&&this.failIncrement<this.props.maxTryToUpper&&this.performance<this.props.max&&(this.upper+=1,this.performance+=1,this.checkCurrentFps=this.props.upperCheckFps),this.emit("change",this.performance),this.store=[]),this.storedMs=0}}}});
